<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="x-poe-datastore-behavior" content="local_only">
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob:;
        connect-src 'self' https://data.etabus.gov.hk https://rt.data.gov.hk;
        frame-src 'self' https://www.youtube.com https://trytako.com;
        child-src 'self';
        manifest-src 'self';
        worker-src 'self';
        style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
        font-src 'self' https://fonts.gstatic.com;
        img-src 'self' data: https://i.imgur.com https://picsum.photos https://images.unsplash.com;
        upgrade-insecure-requests;
        block-all-mixed-content;
    ">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YY Transports ğŸ¦•</title>

    <!-- Font imports (Fredoka) -->
    <style type="text/css">
        @font-face {font-family:Fredoka;font-style:normal;font-weight:400;src:url(/cf-fonts/v/fredoka/5.0.11/latin/wght/normal.woff2);unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;font-display:swap;}
        /* ... (all other @font-face rules remain the same - keeping them out for brevity) ... */
    </style>

    <style>
        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        /* Your original CSS remains unchanged               */
        /* Only showing key parts here for context           */
        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        :root {
            --primary: #4A7FC1;
            --primary-dark: #3A6BA8;
            --secondary: #B8A9C9;
            --accent: #6BCB77;
            --warning: #FFD93D;
            --danger: #E74C3C;
            --bg-light: #F5F7FA;
            --bg-card: #FFFFFF;
            --text-primary: #2C3E50;
            --text-secondary: #6B7C93;
            --mtr-purple: #9B59B6;
            --bus-blue: #3498DB;
            --dino-green: #2ECC71;
        }
        .dark {
            --primary: #5A8FD1;
            --bg-light: #1A1D24;
            --bg-card: #252A34;
            --text-primary: #E8E8E8;
            --text-secondary: #A0AEC0;
        }
        /* ... rest of your beautiful CSS stays exactly the same ... */
    </style>
</head>
<body>

    <!-- Birthday Banner -->
    <div class="birthday-banner">
        <div class="birthday-text">
            <span class="dino-emoji">ğŸ¦–</span>
            Happy <span class="age-badge">30th</span> Birthday YY!
            <span class="dino-emoji">ğŸ¦•</span>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <h1>
            <svg class="header-icon" viewBox="0 0 100 100" fill="white" style="width: 50px; height: 50px; animation: headBob 2s ease-in-out infinite;">
                <!-- Your cute car SVG remains unchanged -->
            </svg>
            YY Transports
        </h1>
    </header>

    <!-- Navigation Tabs -->
    <nav class="nav-tabs" role="tablist">
        <button class="nav-tab active" data-page="work" role="tab" aria-selected="true">
            <span class="icon">ğŸ¢</span>
            <span>Go Work</span>
        </button>
        <button class="nav-tab" data-page="home" role="tab" aria-selected="false">
            <span class="icon">ğŸ </span>
            <span>Go Home</span>
        </button>
    </nav>

    <!-- Content -->
    <main class="content">
        <!-- Go Work Page -->
        <div class="page active" id="page-work">
            <div class="section-header">
                <div class="section-icon bus">ğŸšŒ</div>
                <div>
                    <div class="section-title">Bus 690S</div>
                    <div class="section-subtitle">æ—¥å‡ºåº·åŸé ˜å‡±ç«™</div>
                </div>
            </div>
            <div class="station-card" id="work-bus-card">
                <div class="station-name">æ—¥å‡ºåº·åŸé ˜å‡± LOHAS Park The Visionary</div>
                <span class="route-badge bus">ğŸšŒ 690S</span>
                <div class="eta-list" id="work-bus-eta">
                    <div class="loading-container">
                        <div class="spinner"></div>
                        <div class="loading-text">Getting latest times... ğŸ¦•</div>
                    </div>
                </div>
            </div>

            <div class="section-header">
                <div class="section-icon mtr">ğŸš‡</div>
                <div>
                    <div class="section-title">MTR Tseung Kwan O Line</div>
                    <div class="section-subtitle">LOHAS Park Station åº·åŸç«™</div>
                </div>
            </div>
            <div class="station-card" id="work-mtr-card">
                <div class="station-name">LOHAS Park åº·åŸ</div>
                <span class="route-badge mtr">ğŸš‡ Tseung Kwan O Line</span>
                <div class="eta-list" id="work-mtr-eta">
                    <div class="loading-container">
                        <div class="spinner"></div>
                        <div class="loading-text">Getting latest times... ğŸ¦•</div>
                    </div>
                </div>
            </div>

            <div class="last-updated" id="work-updated"></div>
        </div>

        <!-- Go Home Page -->
        <div class="page" id="page-home">
            <div class="section-header">
                <div class="section-icon bus">ğŸšŒ</div>
                <div>
                    <div class="section-title">Bus 690S</div>
                    <div class="section-subtitle">ç›§æŠ¼é“ç«™</div>
                </div>
            </div>
            <div class="station-card" id="home-bus-card">
                <div class="station-name">ç›§æŠ¼é“ Luard Road</div>
                <span class="route-badge bus">ğŸšŒ 690S</span>
                <div class="eta-list" id="home-bus-eta">
                    <div class="loading-container">
                        <div class="spinner"></div>
                        <div class="loading-text">Getting latest times... ğŸ¦•</div>
                    </div>
                </div>
            </div>

            <!-- North Point MTR -->
            <div class="section-header">
                <div class="section-icon mtr">ğŸš‡</div>
                <div>
                    <div class="section-title">North Point åŒ—è§’ç«™</div>
                    <div class="section-subtitle">Tseung Kwan O Line å°‡è»æ¾³ç¶«</div>
                </div>
            </div>
            <div class="station-card" id="home-mtr-nop-card">
                <div class="station-name">Trains to LOHAS Park / Tiu Keng Leng</div>
                <span class="route-badge mtr">ğŸš‡ â†’ åº·åŸ / èª¿æ™¯å¶ºæ–¹å‘</span>
                <div class="eta-list" id="home-mtr-nop-eta">
                    <div class="loading-container">
                        <div class="spinner"></div>
                        <div class="loading-text">Getting latest times... ğŸ¦•</div>
                    </div>
                </div>
            </div>

            <!-- Tiu Keng Leng MTR -->
            <div class="section-header">
                <div class="section-icon mtr">ğŸš‡</div>
                <div>
                    <div class="section-title">Tiu Keng Leng èª¿æ™¯å¶ºç«™</div>
                    <div class="section-subtitle">Tseung Kwan O Line å°‡è»æ¾³ç¶«</div>
                </div>
            </div>
            <div class="station-card" id="home-mtr-tik-card">
                <div class="station-name">Trains to LOHAS Park åº·åŸ</div>
                <span class="route-badge mtr">ğŸš‡ â†’ åº·åŸæ–¹å‘</span>
                <div class="eta-list" id="home-mtr-tik-eta">
                    <div class="loading-container">
                        <div class="spinner"></div>
                        <div class="loading-text">Getting latest times... ğŸ¦•</div>
                    </div>
                </div>
            </div>

            <div class="last-updated" id="home-updated"></div>
        </div>
    </main>

    <!-- Refresh Button -->
    <button class="refresh-btn" id="refresh-btn" aria-label="Refresh times">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 2v6h-6"></path>
            <path d="M3 12a9 9 0 0 1 15-6.7L21 8"></path>
            <path d="M3 22v-6h6"></path>
            <path d="M21 12a9 9 0 0 1-15 6.7L3 16"></path>
        </svg>
    </button>

    <!-- Decorative Dino -->
    <svg class="dino-decor" viewBox="0 0 100 100" fill="var(--dino-green)">
        <path d="M90 45c0-20-15-35-35-35s-35 15-35 35c0 5 1 10 3 14l-8 8c-2 2-2 5 0 7s5 2 7 0l8-8c4 2 9 4 14 4h8v20c0 3 2 5 5 5s5-2 5-5V75h8v20c0 3 2 5 5 5s5-2 5-5V75c10-5 18-16 18-30zM45 40c-4 0-7-3-7-7s3-7 7-7 7 3 7 7-3 7-7 7zm20 0c-4 0-7-3-7-7s3-7 7-7 7 3 7 7-3 7-7 7z"></path>
    </svg>

    <script>
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // Dark mode
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
            document.documentElement.classList.toggle('dark', e.matches);
        });

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // MTR station name mapping
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const MTR_STATION_NAMES = {
            'LHP': 'LOHAS Park åº·åŸ',
            'TIK': 'Tiu Keng Leng èª¿æ™¯å¶º',
            'TKO': 'Tseung Kwan O å°‡è»æ¾³',
            'HAH': 'Hang Hau å‘å£',
            'POA': 'Po Lam å¯¶ç³',
            'YAT': 'Yau Tong æ²¹å¡˜',
            'NOP': 'North Point åŒ—è§’',
            // ... you can keep adding more if needed ...
        };

        function getStationName(code) {
            return MTR_STATION_NAMES[code] || code;
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // Config & Globals
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const CONFIG = {
            KMB_BASE: 'https://data.etabus.gov.hk/v1/transport/kmb',
            MTR_API: 'https://rt.data.gov.hk/v1/transport/mtr/getSchedule.php',
            MTR_LINE_TKL: 'TKL',
            MTR_STATION_LHP: 'LHP',
            MTR_STATION_TIK: 'TIK',
            MTR_STATION_NOP: 'NOP'
        };

        let currentPage = 'work';

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // Navigation
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        document.querySelectorAll('.nav-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const page = tab.dataset.page;
                switchPage(page);
            });
        });

        function switchPage(page) {
            currentPage = page;
            document.querySelectorAll('.nav-tab').forEach(t => {
                t.classList.remove('active');
                t.setAttribute('aria-selected', 'false');
            });
            document.querySelector(`[data-page="${page}"]`).classList.add('active');
            document.querySelector(`[data-page="${page}"]`).setAttribute('aria-selected', 'true');

            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(`page-${page}`).classList.add('active');

            refreshData();
        }

        // Refresh button
        document.getElementById('refresh-btn').addEventListener('click', () => {
            const btn = document.getElementById('refresh-btn');
            btn.classList.add('spinning');
            refreshData().finally(() => setTimeout(() => btn.classList.remove('spinning'), 600));
        });

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // ETA helpers
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function getMinutesUntil(etaTime) {
            if (!etaTime) return null;
            const diffMs = new Date(etaTime) - new Date();
            return Math.round(diffMs / 60000);
        }

        function shouldRun(mins) {
            return mins !== null && mins >= 0 && mins <= 4;
        }

        function getTimeClass(mins) {
            if (shouldRun(mins)) return 'run';
            if (mins <= 2) return 'arriving';
            if (mins <= 5) return 'soon';
            return 'later';
        }

        function formatETA(mins) {
            if (mins === null || mins === undefined) return '--';
            if (shouldRun(mins)) return mins <= 0 ? 'NOW!' : mins;
            if (mins <= 0) return 'Now';
            return mins;
        }

        function getETALabel(mins) {
            if (shouldRun(mins)) return 'RUN! ğŸƒâ€â™€ï¸';
            if (mins <= 0) return 'Arriving';
            return 'min';
        }

        function renderLoading(container) {
            container.innerHTML = `
                <div class="loading-container">
                    <div class="spinner"></div>
                    <div class="loading-text">Getting latest times... ğŸ¦•</div>
                </div>
            `;
        }

        function renderError(container, msg = "Can't get times right now â€” check internet") {
            container.innerHTML = `
                <div class="error-container">
                    <div class="error-icon">ğŸ¦•ğŸ’¤</div>
                    <div class="error-text">${msg}</div>
                </div>
            `;
        }

        function renderNoData(container) {
            container.innerHTML = `<div class="no-data">No upcoming arrivals ğŸ¦•</div>`;
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // Bus ETA rendering (same as before)
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function renderBusETA(container, etaData) {
            if (!etaData || etaData.length === 0) {
                renderNoData(container);
                return;
            }

            const valid = etaData.filter(item => item.eta).slice(0, 4);

            if (valid.length === 0) {
                renderNoData(container);
                return;
            }

            container.innerHTML = valid.map(item => {
                const mins = getMinutesUntil(item.eta);
                const isRun = shouldRun(mins);
                const dest = item.dest_tc || item.dest_en || 'Unknown';
                const remark = item.rmk_tc || item.rmk_en || '';

                return `
                    <div class="eta-item ${isRun ? 'run-alert' : ''}">
                        <div class="eta-info">
                            <div class="eta-destination">â†’ ${dest}</div>
                            <div class="eta-platform">${remark}</div>
                        </div>
                        <div class="eta-time">
                            <div class="eta-minutes-wrapper">
                                ${isRun ? '<span class="alarm-icon">ğŸš¨</span>' : ''}
                                <span class="eta-minutes ${getTimeClass(mins)}">${formatETA(mins)}</span>
                            </div>
                            <span class="eta-label ${isRun ? 'run' : ''}">${getETALabel(mins)}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // MTR rendering (unchanged)
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function renderMTRSchedule(container, mtrData, line, station, filterDirection = null) {
            if (!mtrData || mtrData.status !== 1) {
                renderError(container);
                return;
            }

            const key = `${line}-${station}`;
            const lineData = mtrData.data?.[key];
            if (!lineData) {
                renderNoData(container);
                return;
            }

            let trains = [];
            if (filterDirection === 'UP' && lineData.UP) {
                trains = lineData.UP.map(t => ({...t, dir: 'UP'}));
            } else if (filterDirection === 'DOWN' && lineData.DOWN) {
                trains = lineData.DOWN.map(t => ({...t, dir: 'DOWN'}));
            } else {
                if (lineData.UP)   trains.push(...lineData.UP.map(t => ({...t, dir: 'UP'})));
                if (lineData.DOWN) trains.push(...lineData.DOWN.map(t => ({...t, dir: 'DOWN'})));
            }

            if (trains.length === 0) {
                renderNoData(container);
                return;
            }

            container.innerHTML = trains.slice(0, 4).map(train => {
                const mins = parseInt(train.ttnt) || 0;
                const isRun = shouldRun(mins);
                const dest = getStationName(train.dest);
                const plat  = train.plat ? `Platform ${train.plat}` : '';

                return `
                    <div class="eta-item ${isRun ? 'run-alert' : ''}">
                        <div class="eta-info">
                            <div class="eta-destination">â†’ ${dest}</div>
                            <div class="eta-platform">${plat}</div>
                        </div>
                        <div class="eta-time">
                            <div class="eta-minutes-wrapper">
                                ${isRun ? '<span class="alarm-icon">ğŸš¨</span>' : ''}
                                <span class="eta-minutes ${getTimeClass(mins)}">${mins <= 0 ? 'NOW!' : mins}</span>
                            </div>
                            <span class="eta-label ${isRun ? 'run' : ''}">${getETALabel(mins)}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderMTRScheduleFiltered(container, mtrData, line, station, allowedDests) {
            if (!mtrData || mtrData.status !== 1) {
                renderError(container);
                return;
            }

            const key = `${line}-${station}`;
            const lineData = mtrData.data?.[key];
            if (!lineData) return renderNoData(container);

            let trains = [];
            if (lineData.UP)   trains.push(...lineData.UP.map(t => ({...t, dir: 'UP'})));
            if (lineData.DOWN) trains.push(...lineData.DOWN.map(t => ({...t, dir: 'DOWN'})));

            trains = trains.filter(t => allowedDests.includes(t.dest));

            if (trains.length === 0) return renderNoData(container);

            container.innerHTML = trains.slice(0, 4).map(train => {
                const mins = parseInt(train.ttnt) || 0;
                const isRun = shouldRun(mins);
                const dest = getStationName(train.dest);
                const plat  = train.plat ? `Platform ${train.plat}` : '';

                return `
                    <div class="eta-item ${isRun ? 'run-alert' : ''}">
                        <div class="eta-info">
                            <div class="eta-destination">â†’ ${dest}</div>
                            <div class="eta-platform">${plat}</div>
                        </div>
                        <div class="eta-time">
                            <div class="eta-minutes-wrapper">
                                ${isRun ? '<span class="alarm-icon">ğŸš¨</span>' : ''}
                                <span class="eta-minutes ${getTimeClass(mins)}">${mins <= 0 ? 'NOW!' : mins}</span>
                            </div>
                            <span class="eta-label ${isRun ? 'run' : ''}">${getETALabel(mins)}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateTimestamp(id) {
            const now = new Date();
            const time = now.toLocaleTimeString('en-HK', {hour:'2-digit', minute:'2-digit', second:'2-digit', hour12:true});
            document.getElementById(id).textContent = `Last updated: ${time} ğŸ¦•`;
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // Main refresh logic â”€ simplified & CORS safer
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        async function refreshData() {
            if (currentPage === 'work') {
                await refreshWorkPage();
            } else {
                await refreshHomePage();
            }
        }

        async function refreshWorkPage() {
            const busEl  = document.getElementById('work-bus-eta');
            const mtrEl  = document.getElementById('work-mtr-eta');

            renderLoading(busEl);
            renderLoading(mtrEl);

            // Bus - prefer route-eta + filter by name
            try {
                const res = await fetch(`${CONFIG.KMB_BASE}/route-eta/690S/1`);
                if (!res.ok) throw new Error();

                const data = await res.json();
                const candidates = data.data || [];

                // Filter for LOHAS Park related stops
                const lohas = candidates.filter(item =>
                    /lohas|åº·åŸ|é ˜å‡±|visionary|æ—¥å‡º/i.test(
                        (item.name_tc||'') + (item.name_en||'') + (item.name_sc||'')
                    )
                );

                renderBusETA(busEl, lohas.length > 0 ? lohas : candidates.slice(0,4));
            } catch {
                renderError(busEl);
            }

            // MTR LOHAS Park
            try {
                const mtr = await fetch(`${CONFIG.MTR_API}?line=${CONFIG.MTR_LINE_TKL}&sta=${CONFIG.MTR_STATION_LHP}`);
                const json = await mtr.json();
                renderMTRSchedule(mtrEl, json, CONFIG.MTR_LINE_TKL, CONFIG.MTR_STATION_LHP);
            } catch {
                renderError(mtrEl);
            }

            updateTimestamp('work-updated');
        }

        async function refreshHomePage() {
            const busEl    = document.getElementById('home-bus-eta');
            const nopEl    = document.getElementById('home-mtr-nop-eta');
            const tikEl    = document.getElementById('home-mtr-tik-eta');

            renderLoading(busEl);
            renderLoading(nopEl);
            renderLoading(tikEl);

            // Bus - route-eta + filter Luard Road
            try {
                const res = await fetch(`${CONFIG.KMB_BASE}/route-eta/690S/1`);
                if (!res.ok) throw new Error();

                const data = await res.json();
                const candidates = data.data || [];

                const luard = candidates.filter(item =>
                    /luard|ç›§æŠ¼é“/i.test(
                        (item.name_tc||'') + (item.name_en||'') + (item.name_sc||'')
                    )
                );

                renderBusETA(busEl, luard.length > 0 ? luard : candidates.slice(0,4));
            } catch {
                renderError(busEl);
            }

            // MTR North Point â†’ LOHAS / TIK
            try {
                const res = await fetch(`${CONFIG.MTR_API}?line=${CONFIG.MTR_LINE_TKL}&sta=${CONFIG.MTR_STATION_NOP}`);
                const json = await res.json();
                renderMTRScheduleFiltered(nopEl, json, CONFIG.MTR_LINE_TKL, CONFIG.MTR_STATION_NOP, ['LHP', 'TIK']);
            } catch {
                renderError(nopEl);
            }

            // MTR Tiu Keng Leng â†’ LOHAS
            try {
                const res = await fetch(`${CONFIG.MTR_API}?line=${CONFIG.MTR_LINE_TKL}&sta=${CONFIG.MTR_STATION_TIK}`);
                const json = await res.json();
                renderMTRScheduleFiltered(tikEl, json, CONFIG.MTR_LINE_TKL, CONFIG.MTR_STATION_TIK, ['LHP']);
            } catch {
                renderError(tikEl);
            }

            updateTimestamp('home-updated');
        }

        // Start
        refreshData();
        setInterval(refreshData, 30000);
    </script>
</body>
</html>
